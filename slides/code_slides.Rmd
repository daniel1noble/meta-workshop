---
title: "Meta-analysis in Comparative Physiology: A brief introduction to effect sizes and meta-analytic modelling"
author: Daniel W.A Noble, Nicholis Wu, Essie Rodgers, Patrice Pottier
output: powerpoint_presentation
date: '`r Sys.Date()`'
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
# Load packages
pacman::p_load(metafor, flextable, tidyverse, orchaRd, pander, mathjaxr, equatags, vembedr, magick)
```

## Slide with Bullets {.secondslide}

- Bullet 1
- Bullet 2
- Bullet 3

$$
y_{i} = x^2
$$

> - Eat eggs
> - Drink coffee

## Slide with R Output {.thirdslide}

```{r cars, echo = TRUE, tidy=TRUE}
# LDH activity in 8 C treatment
 trt_8C <- rnorm(10, 0.40, 0.5)

# LDH activity in 26 C treatment
trt_26C <- rnorm(10, 0.60, 0.20)

# What's the difference, i.e., effect size, between treatments?
mean(trt_26C - trt_8C)
t.test(trt_26C, trt_8C)
```


## Do 1000s of experiments

```{r sim, echo = TRUE, tidy=TRUE}

experiment <- function(times){
  
  dat <- data.frame(matrix(nrow = times, ncol = 2))
  
  for(i in 1:times){
  # LDH activity in 8 C treatment
   trt_8C <- rnorm(10, 0.40, 0.5)
  
  # LDH activity in 26 C treatment
  trt_26C <- rnorm(10, 0.60, 0.20)
  
  # What's the difference, i.e., effect size, between treatments?
  dat[i,1] <- mean(trt_26C - trt_8C)
  dat[i,2] <- t.test(trt_26C, trt_8C)$p.value
    
  }
  names(dat) <- c("effect", "p")
  return(dat)
}

expts <- experiment(10000)
```

## Figure

```{r simfig, echo = FALSE, tidy=TRUE}
par(mfrow = c(1,2))
hist(expts$effect, xlab = "Effect size", main = "")
hist(expts$p, xlab = "p-value", main = "")
```

## errors

$$
SE = SD / \sqrt{N}
$$


```{r simfig2, echo = TRUE, tidy=TRUE}
sd(expts$effect)

```



## se

```{r simfig3, echo = TRUE, tidy=TRUE}
  means <- c()

   for (i in 1:1000000){
      mass <- rnorm(n = 18, mean = 10.8, sd = 0.988)
      means <- c(means, mean(mass))
    }

   # The mean of the means
   mean(means)
   # The standard deviation of the means or standard error
   sd(means)
```

## Our analytical calculaton

```{r se, echo = TRUE, tidy=TRUE}
se <- sd(mass) / sqrt(length(mass))
se
```
## Plots
```{r simfig3plot, echo = TRUE, tidy=TRUE}
   ggplot() + geom_histogram(aes(x = means))
```
